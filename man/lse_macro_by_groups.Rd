% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/lse_macro_by_groups.R
\name{lse_macro_by_groups}
\alias{lse_macro_by_groups}
\title{Generate LSE Macro Estimates for Group Combinations}
\usage{
lse_macro_by_groups(
  df,
  group_vars,
  quants = 0.5,
  total_labels = "TOTAL",
  value_col = "mbls",
  weight_col = "gewibgrs",
  company_col = "entid_n",
  company_size_col = "anzlohn",
  thi_col = "thi",
  th_col = "th",
  nrep_col = "nrep",
  stra_col = "stra_n",
  group1_col = "gr",
  group2_col = "nog_2_08_pub"
)
}
\arguments{
\item{df}{A data frame containing the dataset to analyze.}

\item{group_vars}{A character vector of column names to use for grouping.}

\item{quants}{Numeric vector of quantiles to compute. Default is 0.5 (median).}

\item{total_labels}{Character string to use for total/aggregated groups.
Default is \code{"TOTAL"}.}

\item{value_col}{Character string specifying the column with the main values
for LSE calculation. Default is \code{"mbls"}.}

\item{weight_col}{Character string specifying the column with weights. Default is \code{"gewibgrs"}.}

\item{company_col}{Character string specifying the column identifying companies. Default is \code{"entid_n"}.}

\item{company_size_col}{Character string specifying the column for company size. Default is \code{"anzlohn"}.}

\item{thi_col}{Character string specifying the THI column. Default is \code{"thi"}.}

\item{th_col}{Character string specifying the TH column. Default is \code{"th"}.}

\item{nrep_col}{Character string specifying the column with replication counts. Default is \code{"nrep"}.}

\item{stra_col}{Character string specifying the strategy column. Default is \code{"stra_n"}.}

\item{group1_col}{Character string for an additional grouping variable. Default is \code{"gr"}.}

\item{group2_col}{Character string for another grouping variable. Default is \code{"nog_2_08_pub"}.}
}
\value{
Ein \code{data.frame} mit folgenden Spalten:
\itemize{
\item \code{quant}: Quantile (0.5 = median)
\item \code{value}: Estimated value
\item \code{b_i95}: Lower bound of the 95\% confidence interval
\item \code{b_s95}: Upper bound of the 95\% confidence interval
\item \code{CV_sync95}: Synthetic coefficient of variation based on the variance index (95\%)
\item \code{vari}: Estimated variance
\item \code{n_e}: Number of companies included in the calculation
\item \code{n_s}: Number of wages included in the calculation
\item \code{..}: Grouping variables
}
}
\description{
This function computes macro-level LSE estimates for a dataset across all
combinations of specified grouping variables. It iteratively applies the
\code{lse_macro} function to each subgroup and specified quantile(s),
appending group identifiers or a total label for groups not included in
a particular combination.
}
\details{
The function first generates all combinations of the provided
grouping variables, from the full set down to no grouping (total).
For each combination, the dataset is split into subgroups, and
\code{lse_macro} is applied to each subgroup for each requested quantile.
Any errors encountered during computation are silently skipped (returning
\code{NULL} for that subgroup). The resulting data frames are combined
into a single output.
}
\examples{
\dontrun{
df<-DATA \%>\%
 filter(arbkto == "TG", privoef == 1, nog_2_08 \%in\% c(86,69)) \%>\%
 lse_macro_by_groups(
   group_vars = c( "berufst","geschle","nog_2_08"),
   quants = 0.5
 )
result<-df \%>\%
 mutate(median_char=
          case_when(
            vari >0.05 ~ paste0("[",value,"]"),
            n_s<60  ~ "...",
            n_e<5  ~ "...",
            .default = as.character(value)
          )
 ) \%>\% select(-c(b_i95 ,b_s95 ,value ,CV_sync95  , n_e   ,n_s,vari )) \%>\%
 pivot_wider(
   names_from = berufst ,
   values_from = median_char,
   values_fill = "-"
 )
}

}
