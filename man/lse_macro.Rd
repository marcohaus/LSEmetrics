% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/lse_macro.R
\name{lse_macro}
\alias{lse_macro}
\title{Berechnung von Lohnquantilen und Konfidenzintervallen nach BFS-Makromethode}
\usage{
lse_macro(
  data,
  quant = 0.5,
  value_col = "mbls",
  weight_col = "gewibgrs",
  company_col = "entid_n",
  company_size_col = "anzlohn",
  thi_col = "thi",
  th_col = "th",
  nrep_col = "nrep",
  stra_col = "stra_n",
  group1_col = "gr",
  group2_col = "nog_2_08_pub"
)
}
\arguments{
\item{data}{Ein \code{data.frame} oder \code{tibble}, das die notwendigen Variablen enthält.}

\item{quant}{Numerisch, das gewünschte Quantil (Standard = \code{0.5}, Median).}

\item{value_col}{Zeichenkette, Name der Spalte mit den Lohnangaben
(Standard: \code{"mbls"} = standardisierter Bruttomonatslohn ohne Überstunden).}

\item{weight_col}{Zeichenkette, Name der Spalte mit den Stichprobengewichten
(Standard: \code{"gewibgrs"}).}

\item{company_col}{Zeichenkette, Unternehmensidentifikator (Standard: \code{"entid_n"}).}

\item{company_size_col}{Zeichenkette, Anzahl der Lohnangaben pro Unternehmen
(Standard: \code{"anzlohn"}).}

\item{thi_col}{Zeichenkette, Spalte mit korrigierter Antwortrate intra-Unternehmen
(Standard: \code{"thi"}).}

\item{th_col}{Zeichenkette, Spalte mit korrigierter Antwortrate inter-Unternehmen
(Standard: \code{"th"}).}

\item{nrep_col}{Zeichenkette, Spalte mit der Anzahl der antwortenden Unternehmen
pro Schicht (Standard: \code{"nrep"}).}

\item{stra_col}{Zeichenkette, Schichtungsvariable (Standard: \code{"stra_n"}).}

\item{group1_col}{Zeichenkette, erste Gruppierungsvariable (Standard: \code{"gr"}).}

\item{group2_col}{Zeichenkette, zweite Gruppierungsvariable, typischerweise
Branchenklassifikation (Standard: \code{"nog_2_08_pub"}).}
}
\value{
Ein \code{data.frame} mit folgenden Spalten:
\itemize{
\item \code{quant}: Quantile (0.5 = median)
\item \code{value}: Estimated value
\item \code{b_i95}: Lower bound of the 95\% confidence interval
\item \code{b_s95}: Upper bound of the 95\% confidence interval
\item \code{CV_sync95}: Synthetic coefficient of variation based on the variance index (95\%)
\item \code{vari}: Estimated variance
\item \code{n_e}: Number of companies included in the calculation
\item \code{n_s}: Number of wages included in the calculation
}
}
\description{
\code{LSE_makro()} berechnet gewichtete Lohnquantile (z. B. Median) sowie
deren Varianzschätzung und Konfidenzintervalle gemäss der BFS-Methode.
Die Berechnungen berücksichtigen Unternehmensfaktoren, Stratifizierung sowie
Gewichtungs- und Korrekturfaktoren.
}
\details{
Die Funktion implementiert die vom BFS verwendete Makromethode zur
Varianzschätzung von Lohnquantilen. Sie arbeitet in mehreren Stufen:
\enumerate{
\item Berechnung des gewichteten Quantils mit \code{w.median}.
\item Aggregation auf Unternehmensebene.
\item Hochrechnung und Varianzschätzung auf startifizierte
Gruppen unter Einbezug der Korrekturfaktoren.
\item Aggregation und Berechnung von Konfidenzintervallen.
}
}
\examples{
\dontrun{
library(dplyr)
library(purrr)

# Einfacher Aufruf: Medianlohn für TG, privater Sektor
DATEN \%>\%
  filter(arbkto == "TG", privoef == 1) \%>\%
  lse_macro(quant = 0.5)

# Beispiel mit Gruppierung: 90\%-Quantil nach Geschlecht und Beruf
DATEN \%>\%
  filter(arbkto == "TG", privoef == 1) \%>\%
  group_split(geschle, berufst) \%>\%
  map_dfr(~ lse_macro(.x, quant = 0.5) \%>\%
            mutate(
              geschle = unique(.x$geschle),
              berufst = unique(.x$berufst)
            ))

# Mehrere Quantile (25\%, 50\%, 75\%) nach Geschlecht und Beruf
DATEN \%>\%
  filter(arbkto == "TG", privoef == 1) \%>\%
  group_split(geschle, berufst) \%>\%
  map_dfr(~ {
    map_dfr(c(0.25, 0.5, 0.75), function(q) {
      lse_macro(.x, quant = q) \%>\%
        mutate(
          geschle = unique(.x$geschle),
          berufst = unique(.x$berufst)
        )
    })
  })
}
}
